{% extends "base.html" %}
{% block title %}{{title}}{% endblock title %}

{% block content %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Three.js, Chart.js –∏ Leaflet (OpenStreetMap) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ SOS */
    .stats-header {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .stats-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .period-selector {
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .period-btn {
        margin: 0 5px;
        border-radius: 25px;
        padding: 8px 20px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .period-btn.active {
        background-color: #ff6b6b;
        color: white;
    }
    
    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    }
    
    .stat-card h3 {
        color: #333;
        margin-bottom: 1rem;
        font-size: 1.3rem;
        font-weight: 600;
    }
    
    .big-number {
        font-size: 3rem;
        font-weight: 800;
        color: #ff6b6b;
        text-align: center;
        margin: 1rem 0;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .container-3d {
        height: 300px;
        border-radius: 10px;
        overflow: hidden;
        background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        position: relative;
    }
    
    .chart-container {
        height: 250px;
        position: relative;
    }
    
    .category-stats {
        display: flex;
        justify-content: space-around;
        margin-top: 1rem;
    }
    
    .category-item {
        text-align: center;
        padding: 1rem;
        border-radius: 10px;
        background: rgba(255, 107, 107, 0.1);
        margin: 0 5px;
        flex: 1;
    }
    
    .category-item h4 {
        margin: 0;
        color: #ff6b6b;
        font-size: 1rem;
    }
    
    .category-item p {
        margin: 5px 0 0 0;
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
    }
    
    .floating-elements {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }
    
    .floating-circle {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 107, 107, 0.1);
        animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .loading {
        text-align: center;
        color: #666;
        font-size: 1rem;
        margin: 50px 0;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è OpenStreetMap –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω */
    .custom-popup .leaflet-popup-content-wrapper {
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .custom-popup .leaflet-popup-content {
        margin: 0;
        padding: 0;
    }
    
    .custom-popup .leaflet-popup-tip {
        background: white;
        border: none;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
</style>

<!-- –ü–ª–∞–≤–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ñ–æ–Ω–∞ -->
<div class="floating-elements">
    <div class="floating-circle" style="width: 80px; height: 80px; top: 10%; left: 10%; animation-delay: 0s;"></div>
    <div class="floating-circle" style="width: 120px; height: 120px; top: 20%; right: 10%; animation-delay: 2s;"></div>
    <div class="floating-circle" style="width: 60px; height: 60px; bottom: 20%; left: 20%; animation-delay: 4s;"></div>
    <div class="floating-circle" style="width: 100px; height: 100px; bottom: 10%; right: 20%; animation-delay: 1s;"></div>
</div>

<div class="stats-header">
    <h1>üö® –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ SOS</h1>
    <p class="mb-0">{{ title }}</p>
</div>

<!-- –°–µ–ª–µ–∫—Ç–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
<div class="period-selector">
    <a href="{% url 'web:sos_stats' 'day' %}" class="btn btn-outline-danger period-btn {% if 'SOS –æ—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å' in title %}active{% endif %}">–î–µ–Ω—å</a>
    <a href="{% url 'web:sos_stats' 'week' %}" class="btn btn-outline-danger period-btn {% if 'SOS –æ—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é' in title %}active{% endif %}">–ù–µ–¥–µ–ª—è</a>
    <a href="{% url 'web:sos_stats' 'month' %}" class="btn btn-outline-danger period-btn {% if 'SOS –æ—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü' in title %}active{% endif %}">–ú–µ—Å—è—Ü</a>
    <a href="{% url 'web:sos_stats' 'year' %}" class="btn btn-outline-danger period-btn {% if 'SOS –æ—Ç—á—ë—Ç –∑–∞ –≥–æ–¥' in title %}active{% endif %}">–ì–æ–¥</a>
    <a href="{% url 'web:sos_stats' 'all' %}" class="btn btn-outline-danger period-btn {% if '–í—Å–µ SOS —Å–æ–æ–±—â–µ–Ω–∏—è' in title %}active{% endif %}">–í—Å–µ –≤—Ä–µ–º—è</a>
</div>

<div class="row">
    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="col-lg-3 col-md-6">
        <div class="stat-card">
            <h3>üö® –í—Å–µ–≥–æ SOS</h3>
            <div class="big-number">{{ total_sos|default:0 }}</div>
            <p class="text-center text-muted">–∑–∞ –ø–µ—Ä–∏–æ–¥</p>
        </div>
    </div>
    
    <!-- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
    <div class="col-lg-3 col-md-6">
        <div class="stat-card">
            <h3>‚è±Ô∏è –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</h3>
            <div class="big-number">{{ avg_response_time|default:0 }}</div>
            <p class="text-center text-muted">–º–∏–Ω—É—Ç</p>
        </div>
    </div>
    
    <!-- –ü—Ä–æ—Ü–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö -->
    <div class="col-lg-3 col-md-6">
        <div class="stat-card">
            <h3>‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</h3>
            <div class="big-number">{{ response_percent|default:0 }}</div>
            <p class="text-center text-muted">%</p>
        </div>
    </div>
    
    <!-- –í –æ–±—Ä–∞–±–æ—Ç–∫–µ -->
    <div class="col-lg-3 col-md-6">
        <div class="stat-card">
            <h3>‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏</h3>
            <div class="big-number">{{ active_sos|default:0 }}</div>
            <p class="text-center text-muted">—Å–æ–æ–±—â–µ–Ω–∏–π</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º -->
    <div class="col-lg-4 col-md-6">
        <div class="stat-card">
            <h3>üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</h3>
            <div class="big-number">{{ kazakhstan_sos_count|default:0 }}</div>
            <p class="text-center text-muted">SOS –Ω–∞ –∫–∞—Ä—Ç–µ</p>
        </div>
    </div>
    
    <!-- –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ -->
    <div class="col-lg-4 col-md-6">
        <div class="stat-card">
            <h3>üïê –ó–∞ 24 —á–∞—Å–∞</h3>
            <div class="big-number">{{ last_24h_sos|default:0 }}</div>
            <p class="text-center text-muted">–Ω–æ–≤—ã—Ö SOS</p>
        </div>
    </div>
    
    <!-- –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ SOS -->
    <div class="col-lg-4 col-md-6">
        <div class="stat-card">
            <h3>‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ</h3>
            <div class="big-number">{{ processed_sos|default:0 }}</div>
            <p class="text-center text-muted">SOS</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- 3D –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ -->
    <div class="col-lg-8 col-md-6">
        <div class="stat-card">
            <h3>üéØ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
            <div class="container-3d" id="3d-pie-chart">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ 3D –º–æ–¥–µ–ª–∏...</div>
            </div>
        </div>
    </div>
    
    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="col-lg-4 col-md-6">
        <div class="stat-card">
            <h3>üìã –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="category-stats">
                <div class="category-item">
                    <h4>üö® –ê–∫—Ç–∏–≤–Ω—ã–µ</h4>
                    <p id="active-count">0</p>
                </div>
                <div class="category-item">
                    <h4>‚úÖ –†–µ—à–µ–Ω—ã</h4>
                    <p id="processed-count">0</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- OpenStreetMap —Å —Ç–æ—á–∫–∞–º–∏ SOS -->
    <div class="col-lg-6 col-md-6">
        <div class="stat-card">
            <h3>üó∫Ô∏è –ì–µ–æ–≥—Ä–∞—Ñ–∏—è SOS</h3>
            <div id="openstreetmap" style="height: 400px; width: 100%; border-radius: 10px; overflow: hidden;">
                <div class="loading" style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f9fa;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...
                </div>
            </div>
            <!-- –õ–µ–≥–µ–Ω–¥–∞ –¥–ª—è –∫–∞—Ä—Ç—ã -->
            <div class="mt-3">
                <div class="d-flex justify-content-center flex-wrap">
                    <div class="mx-2 mb-1">
                        <span style="display: inline-block; width: 12px; height: 12px; background-color: #ff4444; border-radius: 50%; margin-right: 5px;"></span>
                        <small>–ê–∫—Ç–∏–≤–Ω—ã–µ SOS</small>
                    </div>
                    <div class="mx-2 mb-1">
                        <span style="display: inline-block; width: 12px; height: 12px; background-color: #44ff44; border-radius: 50%; margin-right: 5px;"></span>
                        <small>–†–µ—à–µ–Ω—ã</small>
                    </div>
                </div>
                <small class="text-muted d-block text-center mt-2">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π</small>
            </div>
        </div>
    </div>
    
    <!-- –ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–¥–æ–≤ -->
    <div class="col-lg-6 col-md-6">
        <div class="stat-card">
            <h3>üìà –¢—Ä–µ–Ω–¥—ã SOS</h3>
            <div class="chart-container">
                <canvas id="trend-chart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<div style="text-align: center; margin-top: 2rem;">
    <a href="{% url 'web:reports_period' 'day'  %}" class="btn btn-outline-primary" style="margin: 0 10px;">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–ª–æ–±
    </a>
    <a href="{% url 'web:sos_stats' 'day' %}" class="btn btn-outline-danger" style="margin: 0 10px;">
        üö® SOS –°–æ–æ–±—â–µ–Ω–∏—è
    </a>
</div>

<script>
// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Django
const activeCount = parseInt('{{ active_sos|default:0 }}');
const pendingCount = parseInt('{{ pending_sos|default:0 }}');
const processedCount = parseInt('{{ processed_sos|default:0 }}');
const totalCount = parseInt('{{ total_sos|default:0 }}');

// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
document.getElementById('active-count').textContent = activeCount;
document.getElementById('processed-count').textContent = processedCount;

// 3D –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–ª—è SOS
function create3DSOSPieChart() {
    const container = document.getElementById('3d-pie-chart');
    container.innerHTML = '';
    
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setClearColor(0x000000, 0);
    container.appendChild(renderer.domElement);
    
    // –°–æ–∑–¥–∞–µ–º 3D —Å–µ–≥–º–µ–Ω—Ç—ã –¥–ª—è SOS
    const segments = [
        { count: activeCount, color: 0xff4444, label: '–ê–∫—Ç–∏–≤–Ω—ã–µ' },
        { count: processedCount, color: 0x44ff44, label: '–†–µ—à–µ–Ω—ã' }
    ];
    
    const group = new THREE.Group();
    let angle = 0;
    
    segments.forEach((segment, index) => {
        if (segment.count > 0) {
            const geometry = new THREE.CylinderGeometry(0.4, 0.4, 0.1, 32);
            const material = new THREE.MeshPhongMaterial({ color: segment.color });
            const cylinder = new THREE.Mesh(geometry, material);
            
            const segmentAngle = (segment.count / totalCount) * Math.PI * 2;
            cylinder.rotation.z = angle;
            cylinder.position.x = Math.cos(angle + segmentAngle/2) * 0.3;
            cylinder.position.y = Math.sin(angle + segmentAngle/2) * 0.3;
            
            group.add(cylinder);
            angle += segmentAngle;
        }
    });
    
    scene.add(group);
    
    // –û—Å–≤–µ—â–µ–Ω–∏–µ
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 5, 5);
    scene.add(light);
    
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
    scene.add(ambientLight);
    
    camera.position.z = 2.5;
    
    // –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    
    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        group.rotation.y += 0.005;
        renderer.render(scene, camera);
    }
    
    animate();
}

// OpenStreetMap —Å —Ç–æ—á–∫–∞–º–∏ SOS
let map;
let markers = [];

function initSOSOpenStreetMap() {
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã SOS –∏–∑ Django
    const sosCoords = JSON.parse('{{ sos_coords|escapejs }}');
    
    // –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã –Ω–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ
    const kazakhstanCenter = [48.0196, 66.9237];
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
    map = L.map('openstreetmap').setView(kazakhstanCenter, 5);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 18
    }).addTo(map);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const loadingDiv = document.querySelector('#openstreetmap .loading');
    if (loadingDiv) {
        loadingDiv.style.display = 'none';
    }
    
    // –¶–≤–µ—Ç–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º SOS
    const markerColors = {
        'ACTIVE': 'red',
        'PROCESSED': 'green'
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ SOS
    sosCoords.forEach((sos, index) => {
        const marker = L.circleMarker([sos.lat, sos.lon], {
            radius: 10,
            fillColor: markerColors[sos.status] || 'red',
            color: '#fff',
            weight: 2,
            opacity: 1,
            fillOpacity: 0.8
        }).addTo(map);
        
        // –°–æ–∑–¥–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
        const popupContent = createSOSPopupContent(sos);
        marker.bindPopup(popupContent, {
            maxWidth: 300,
            className: 'custom-popup'
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –º–∞—Ä–∫–µ—Ä
        marker.on('click', function(e) {
            this.openPopup();
        });
        
        markers.push(marker);
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥–æ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–± –ø–æ–¥ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
    if (markers.length > 0) {
        const group = new L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ SOS
function createSOSPopupContent(sos) {
    const statusText = sos.status === 'PROCESSED' ? '‚úÖ –†–µ—à–µ–Ω' : 'üö® –ê–∫—Ç–∏–≤–µ–Ω';
    const statusColor = sos.status === 'PROCESSED' ? '#28a745' : '#dc3545';
    
    return `
        <div style="max-width: 300px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            <div style="border-bottom: 2px solid #ff6b6b; padding-bottom: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0; color: #ff6b6b; font-size: 1.2rem;">üö® SOS</h4>
            </div>
            
            <div style="margin-bottom: 10px;">
                <strong>üë§ –ò–º—è:</strong> ${sos.name}
            </div>
            
            <div style="margin-bottom: 10px;">
                <strong>üÜî –ò–ò–ù:</strong> ${sos.iin}
            </div>
            
            <div style="margin-bottom: 10px;">
                <strong>üì± Telegram:</strong> ${sos.tg_id || '–ù–µ —É–∫–∞–∑–∞–Ω'}
            </div>
            
            <div style="margin-bottom: 15px;">
                <strong>üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong><br>
                <div style="
                    background: #f8f9fa; 
                    padding: 10px; 
                    border-radius: 5px; 
                    margin-top: 5px; 
                    border-left: 3px solid #ff6b6b;
                    font-size: 0.9rem;
                    line-height: 1.4;
                ">${sos.lat}, ${sos.lon}</div>
            </div>
            
            <div style="text-align: center;">
                <span style="
                    padding: 5px 15px; 
                    border-radius: 20px; 
                    font-weight: 600;
                    font-size: 0.9rem;
                    background: ${statusColor};
                    color: white;
                ">${statusText}</span>
            </div>
        </div>
    `;
}

// –ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–¥–æ–≤ –¥–ª—è SOS
function createSOSTrendChart() {
    const ctx = document.getElementById('trend-chart').getContext('2d');
    
    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
    if (window.sosTrendChart) {
        window.sosTrendChart.destroy();
    }
    
    // –î–∞–Ω–Ω—ã–µ –¥–ª—è SOS —Ç—Ä–µ–Ω–¥–æ–≤
    const labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'];
    const data = [totalCount * 0.1, totalCount * 0.05, totalCount * 0.3, totalCount * 0.8, totalCount * 1.2, totalCount * 0.9, totalCount * 0.4];
    
    window.sosTrendChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'SOS —Å–æ–æ–±—â–µ–Ω–∏—è',
                data: data,
                borderColor: '#ff6b6b',
                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#ff6b6b',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    }
                }
            }
        }
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        create3DSOSPieChart();
        initSOSOpenStreetMap();
        createSOSTrendChart();
    }, 500);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
window.addEventListener('resize', function() {
    setTimeout(() => {
        create3DSOSPieChart();
    }, 100);
});
</script>
{% endblock content %}
