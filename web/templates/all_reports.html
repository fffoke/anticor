{% extends "base.html" %}
{% block title %}–í—Å–µ –∂–∞–ª–æ–±—ã{% endblock title %}

{% block content %}


<style>
  .stats-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .stats-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
     .empty-state {
        text-align: center;
        padding: 3rem;
        color: #666;
    }
    
    .empty-state i {
        font-size: 4rem;
        color: #ddd;
        margin-bottom: 1rem;
    }
</style>
  <div class="stats-header">
    <h1>üìã –í—Å–µ –∂–∞–ª–æ–±—ã</h1>
    <p class="mb-0">{{ title }}</p>
  </div>
   <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        {% if active_category %}
          {% if active_category == "CRITICAL" %} –í–∞–∂–Ω—ã–µ
          {% elif active_category == "SECONDARY" %} –û–±—ã—á–Ω—ã–µ
          {% elif active_category == "SPAM" %} –°–ø–∞–º
          {% endif %}
        {% else %}
          –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        {% endif %}
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="{% url 'web:all_reports' %}">–í—Å–µ</a></li>
        <li><a class="dropdown-item" href="{% url 'web:reports_by_category' 'CRITICAL' %}">–í–∞–∂–Ω—ã–µ</a></li>
        <li><a class="dropdown-item" href="{% url 'web:reports_by_category' 'SECONDARY' %}">–û–±—ã—á–Ω—ã–µ</a></li>
        <li><a class="dropdown-item" href="{% url 'web:reports_by_category' 'SPAM' %}">–°–ø–∞–º</a></li>
      </ul>
    </div>
</div>
<br>
  {% if reports %}
  <div class="accordion" id="reportsAccordion">
    {% for report in reports %}
    {% if not report.is_decided %}
      <div class="accordion-item mb-2 shadow-sm border-0">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
            <strong>{{ report.title }}</strong>
            <span class="ms-2">
              {% if report.category == "CRITICAL" %}
                <span class="badge bg-danger">–í–∞–∂–Ω–∞—è</span>
              {% elif report.category == "SECONDARY" %}
                <span class="badge bg-warning text-dark">–û–±—ã—á–Ω–∞—è</span>
              {% else %}
                <span class="badge bg-secondary">–°–ø–∞–º</span>
              {% endif %}
            </span>
          </button>
        </h2>

        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#reportsAccordion">
          <div class="accordion-body">
            {% if report.image %}
              <img src="{{ report.image.url }}" class="img-fluid rounded mb-3" alt="{{ report.title }}">
            {% endif %}

            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ report.text }}</p>

            {% if report.latitude and report.longitude %}
              <a href="https://2gis.kz/geo/{{ report.latitude }},{{ report.longitude }}" target="_blank" class="btn btn-primary btn-sm">
                üìç –û—Ç–∫—Ä—ã—Ç—å –≤ 2–ì–ò–°
              </a>
              <br>
            {% else %}
              <button class="btn btn-secondary btn-sm" disabled>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ</button>
            {% endif %}
              <br>
              <form method="POST" action="{% url 'web:is_decided' report.id %}">
                {% csrf_token %} 
                <button type="submit" name="action" value="approve" class="btn btn-success">–†–µ—à–∏—Ç—å</button>
              </form>
            <p class="text-muted small mt-3 mb-0">–î–æ–±–∞–≤–ª–µ–Ω–æ: {{ report.created_at|date:"d.m.Y H:i" }}</p>
          </div>
        </div>
      </div>
      {% endif %}
    {% endfor %}
  </div>
  {% else %}
    <div class="empty-state">
            <i>üìã</i>
            <h3>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∂–∞–ª–æ–±</h3>
            <p>–í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã</p>
        </div>
  {% endif %}
  

{% endblock content %}
